import pandas as pd

df=pd.read_excel('C:\\Users\\user\\Desktop\\aroha\\DW\\Ilearnonlinelogs_ETL1.xlsx','Ilearnonlinelogs')

ilearnonlinelogs=df[df['path'] != '/']

log_rejected=df[df['path'] == '/'].reset_index()
log_rejected.drop(columns='index',inplace=True)

course_log_unwanted=ilearnonlinelogs[ilearnonlinelogs['path'].str.count('/') <=3].reset_index()
course_log_unwanted.drop(columns='index',inplace=True)

ilearnonlinelogs=ilearnonlinelogs[ilearnonlinelogs['path'].str.count('/') >= 4].reset_index()
ilearnonlinelogs.drop(columns='index',inplace=True)


employee=pd.DataFrame()
employee['emp_id']=ilearnonlinelogs['id']
employee['first_name']=ilearnonlinelogs['first_name']
employee['last_name']=ilearnonlinelogs['last_name']

ilearnaccess=pd.DataFrame()
ilearnaccess['access_id']=[i+1 for i in range(len(employee))]
ilearnaccess['access_date'] = ilearnonlinelogs['timestamp'].dt.strftime('%Y-%m-%d')
ilearnaccess['emp_id']=employee['emp_id']
ilearnaccess['course_name']=[i.split('/')[2] for i in ilearnonlinelogs['path']]
ilearnaccess['chapter']=[i.split('/')[3] for i in ilearnonlinelogs['path']]

log_rejected.to_csv('log_rejected.txt',index=False)
course_log_unwanted.to_csv('course_log_unwanted.txt',index=False)
ilearnonlinelogs.to_csv('ilearnonlinelogs.csv',index=False)
employee.to_csv('employee.csv',index=False)
ilearnaccess.to_csv('ilearnaccess.csv',index=False)